<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Really Cool</title>

    <style>
        body {
            background-color: black;
        }
        #render {
            background-color: darkslateblue;
            padding: 20px;
            line-height: 0;
        }
        label {
            color: salmon;
        }
        .square {
            display: inline-block;
        }
    </style>
</head>
<body>
    <div>
        <label>
            Rows
            <input id="rows" type="number" value="10" />
        </label>
    </br>
        <label>
            Cols
            <input id="cols" type="number" value="4">
        </label>
    </br>
        <label>
            Speed
            <input id="rangeSpd" type="range" value="1000" min="50" max="2000" step="50" />
        </label>
    </br>
        <label>
            Size
            <input id="sizeInput" type="number" value="20">
        </label>
    </br>
        <label for="themeSelect">
            Theme
            <select name="themeSelect" id="themeSelect">
                <option value="">None</option>
                <option value="rainbow">Rainbow</option>
                <option value="opacity">Opcaity</option>
                <option value="heatmap">Heatmap</option>
                
            </select>
        </label>
    </div>
    <div id="render">
        
    </div>
    <script>
        console.log("Hello world!");

        function isLocalStorageEmpty(item) {
            if (!item) {
                return true;
            }
            if (item == 'null') {
                return true;
            }
            
            return false;
        }
        
        var name = window.localStorage.getItem('name');
        
        if (isLocalStorageEmpty(name)) {
            console.log('missing')
            window.localStorage.setItem('name', 'Carson');
        }

        name = window.localStorage.getItem('name');
        console.log(name)

        var rows_input = document.getElementById("rows");
        var cols_input = document.getElementById("cols");
        var render_ele = document.getElementById("render");
        var range_input = document.getElementById("rangeSpd");
        var sizeInput = document.getElementById("sizeInput");
        var themeSelectEle = document.getElementById("themeSelect");
        var selectedTheme =  null;

        console.log(rows_input.value);
        console.log(cols_input.value);

        rows_input.addEventListener("change", function () {
            console.log("Row input change: " + rows_input.value);
            window.localStorage.setItem('row_value', rows_input.value);
        });
        rows_input.value = window.localStorage.getItem('row_value');

        var nameObject = {
            name: "Carson",
            age: 20
        };
        console.log(nameObject)
        console.log(JSON.stringify(nameObject))
        window.localStorage.setItem('name_object', JSON.stringify(nameObject));

        cols_input.addEventListener("change", function () {
            console.log("Col input change: " + cols_input.value);
            window.localStorage.setItem('col_value', cols_input.value);
        });
        cols_input.value = window.localStorage.getItem('col_value');

        var renderInterval = setInterval(render, 1000);
        range_input.addEventListener("change", function (e) {
            //console.log("Col input change: " + cols_input.value);
            clearInterval(renderInterval);
            renderInterval = setInterval(render, e.target.value)
        });

        themeSelectEle.addEventListener("change", function (e) {
            //console.log(e.target);
            selectedTheme = e.currentTarget.options[e.target.selectedIndex].value;
            console.log(selectedTheme);
        });

        const hsl_col_perc = (percent, start, end) => {
            const a = percent / 100,
            b = (end - start) * a,
            c = b + start;
            return 'hsl(' + c + ', 100%, 50%)';
        }

        function styleElement(element, rand, colIndex, colCount) {
            if (rand >= colIndex) {
                if (!selectedTheme) {
                    element.style.backgroundColor = 'chartruese'
                    element.style.accentColor = 'chartruese'
                } else if (selectedTheme == 'rainbow') {
                    element.style.backgroundColor = hsl_col_perc((colIndex + 1) / colCount * 100, 0, 360);
                    element.style.accentColor = hsl_col_perc((colIndex + 1) / colCount * 100, 0, 360);
                } else if (selectedTheme == 'opacity') {
                    element.style.opacity = (colIndex + 1) / colCount;
                } else if (selectedTheme == 'heatmap') {
                    element.style.backgroundColor = hsl_col_perc(100 - rand / colCount * 100, 0, 120);
                    element.style.accentColor = hsl_col_perc(100 - rand / colCount * 100, 0, 120);
                }
            }
            return element;
        }

        function renderSquare(c, colCount, r, rowCount, ran_num) {
            var element = document.createElement("input");
            element.className = 'square';
            element.style.width = sizeInput.value + 'px';
            element.style.height = sizeInput.value + 'px';
            element = styleElement(element, ran_num, c, colCount);
            return element;
        }

        function renderCheckbox(c, colCount, r, rowCount, ran_num) {
            var checkbox = document.createElement("input");
                    checkbox.type = "checkbox";
                    checkbox.checked = true;
                    checkbox.style.width = sizeInput.value + 'px';
                    checkbox.style.height = sizeInput.value + 'px';
                    checkbox = styleElement(checkbox, ran_num, c, colCount);
                    return checkbox;
        }

        function render() {
            //console.log("RENDER");
            //console.log(rows_input.value, cols_input.value);
            render_ele.innerHTML = '';

            
            var colCount = cols_input.value;
            var rowCount = rows_input.value; 
            for (var r = 1; r <= rows_input.value; r++) {
                //console.log(r);
                var ran_num = Math.floor(Math.random()*colCount);
                for (var c = 1; c <= cols_input.value; c++) {
                    //console.log(c);
                    var checkbox = renderCheckbox(c, colCount, r, rowCount, ran_num);
                    var element = renderSquare(c, colCount, r, rowCount, ran_num);
                    render_ele.appendChild(element);
                } 
                render_ele.appendChild(document.createElement("br"));
            }

            
        }
        render();

        
        //clearInterval(renderInterval);
    </script>
</body>
</html>